<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="User Settings - Manage your account and password">
    <title>Settings | Stress Detection in IT Professionals</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-brand">
                <span class="sidebar-brand-icon">ðŸ§ </span>
                <span class="sidebar-brand-text">StressDetect<span class="text-gradient">AI</span></span>
            </div>

            <nav class="sidebar-menu">
                <a href="user-dashboard.html" class="sidebar-link">
                    <span class="sidebar-link-icon"><i class="fas fa-home"></i></span>
                    Dashboard
                </a>
                <a href="user-dashboard.html" class="sidebar-link">
                    <span class="sidebar-link-icon"><i class="fas fa-camera"></i></span>
                    New Scan
                </a>
                <a href="results.html" class="sidebar-link">
                    <span class="sidebar-link-icon"><i class="fas fa-chart-bar"></i></span>
                    My Results
                </a>

                <div class="sidebar-section">Account</div>

                <a href="#" class="sidebar-link">
                    <span class="sidebar-link-icon"><i class="fas fa-user"></i></span>
                    Profile
                </a>
                <a href="settings.html" class="sidebar-link active">
                    <span class="sidebar-link-icon"><i class="fas fa-cog"></i></span>
                    Settings
                </a>
                <a href="index.html" class="sidebar-link" id="logoutBtn">
                    <span class="sidebar-link-icon"><i class="fas fa-sign-out-alt"></i></span>
                    Logout
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="dashboard-header">
                <div>
                    <h1 class="dashboard-title">Account <span class="text-gradient">Settings</span></h1>
                    <p class="text-muted" style="margin-bottom: 0;">Manage your account preferences and security</p>
                </div>

                <div class="dashboard-user">
                    <div class="user-avatar" id="userAvatar">JD</div>
                </div>
            </header>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <!-- Profile Information -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-user" style="color: var(--primary-400); margin-right: 0.5rem;"></i>
                            Profile Information
                        </h3>
                    </div>

                    <form id="profileForm">
                        <div class="form-group">
                            <label class="form-label" for="fullName">Full Name</label>
                            <input type="text" id="fullName" class="form-input" placeholder="Your full name">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="email">Email Address</label>
                            <input type="email" id="email" class="form-input" placeholder="your@email.com" disabled>
                            <span class="form-hint">Email cannot be changed</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="mobile">Mobile Number</label>
                            <input type="tel" id="mobile" class="form-input" placeholder="Your mobile number">
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Save Changes
                        </button>
                    </form>
                </div>

                <!-- Change Password -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-lock" style="color: var(--accent-400); margin-right: 0.5rem;"></i>
                            Change Password
                        </h3>
                    </div>

                    <form id="passwordForm">
                        <div class="form-group">
                            <label class="form-label required" for="currentPassword">Current Password</label>
                            <div class="input-group">
                                <input type="password" id="currentPassword" class="form-input"
                                    placeholder="Enter current password" required>
                                <span class="input-group-addon toggle-password" data-target="currentPassword">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                            <span class="form-error d-none" id="currentPasswordError"></span>
                        </div>

                        <div class="form-group">
                            <label class="form-label required" for="newPassword">New Password</label>
                            <div class="input-group">
                                <input type="password" id="newPassword" class="form-input"
                                    placeholder="Enter new password" required>
                                <span class="input-group-addon toggle-password" data-target="newPassword">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                            <span class="form-hint">Must be at least 6 characters</span>
                            <span class="form-error d-none" id="newPasswordError"></span>

                            <!-- Password Strength -->
                            <div class="mt-4">
                                <div class="progress">
                                    <div class="progress-bar" id="passwordStrength" style="width: 0%;"></div>
                                </div>
                                <span class="form-hint" id="passwordStrengthText">Password strength: Enter a
                                    password</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required" for="confirmPassword">Confirm New Password</label>
                            <div class="input-group">
                                <input type="password" id="confirmPassword" class="form-input"
                                    placeholder="Confirm new password" required>
                                <span class="input-group-addon toggle-password" data-target="confirmPassword">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                            <span class="form-error d-none" id="confirmPasswordError"></span>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-key"></i>
                            Update Password
                        </button>
                    </form>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="card mt-8" style="border-color: var(--danger);">
                <div class="card-header">
                    <h3 class="card-title" style="color: var(--danger);">
                        <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>
                        Danger Zone
                    </h3>
                </div>

                <div class="d-flex justify-between align-center">
                    <div>
                        <h4 style="margin-bottom: 0.25rem;">Delete Account</h4>
                        <p style="margin: 0; color: var(--dark-text-muted); font-size: 0.9rem;">
                            Permanently delete your account and all associated data. This action cannot be undone.
                        </p>
                    </div>
                    <button class="btn btn-danger" id="deleteAccountBtn">
                        <i class="fas fa-trash"></i>
                        Delete Account
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Delete Account</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <p id="modalMessage">Are you sure you want to delete your account? This will permanently remove all your
                data including scan history. This action cannot be undone.</p>
            <div class="d-flex gap-4 justify-center mt-6">
                <button class="btn btn-secondary" id="modalCancel">Cancel</button>
                <button class="btn btn-danger" id="modalConfirm">
                    <i class="fas fa-trash"></i>
                    Delete Permanently
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script>
        // Load current user data
        document.addEventListener('DOMContentLoaded', () => {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');

            if (!currentUser.email) {
                window.location.href = 'login.html';
                return;
            }

            // Populate form
            document.getElementById('fullName').value = currentUser.name || '';
            document.getElementById('email').value = currentUser.email || '';
            document.getElementById('mobile').value = currentUser.mobile || '';
            document.getElementById('userAvatar').textContent = currentUser.name ?
                currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase() : 'U';
        });

        // Profile form submission
        document.getElementById('profileForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const users = JSON.parse(localStorage.getItem('users') || '[]');

            const newName = document.getElementById('fullName').value.trim();
            const newMobile = document.getElementById('mobile').value.trim();

            if (newName.length < 2) {
                showToast('Please enter a valid name', 'error');
                return;
            }

            // Update user in users array
            const userIndex = users.findIndex(u => u.email === currentUser.email);
            if (userIndex !== -1) {
                users[userIndex].name = newName;
                users[userIndex].mobile = newMobile;
                localStorage.setItem('users', JSON.stringify(users));
            }

            // Update current user session
            currentUser.name = newName;
            currentUser.mobile = newMobile;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            // Update avatar
            document.getElementById('userAvatar').textContent = newName.split(' ').map(n => n[0]).join('').toUpperCase();

            showToast('Profile updated successfully!', 'success');
        });

        // Password form submission
        document.getElementById('passwordForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const users = JSON.parse(localStorage.getItem('users') || '[]');

            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Clear errors
            document.querySelectorAll('.form-error').forEach(el => el.classList.add('d-none'));

            // Find user
            const userIndex = users.findIndex(u => u.email === currentUser.email);
            if (userIndex === -1) {
                showToast('User not found', 'error');
                return;
            }

            // Validate current password
            if (users[userIndex].password !== currentPassword) {
                document.getElementById('currentPasswordError').textContent = 'Current password is incorrect';
                document.getElementById('currentPasswordError').classList.remove('d-none');
                return;
            }

            // Validate new password
            if (newPassword.length < 6) {
                document.getElementById('newPasswordError').textContent = 'Password must be at least 6 characters';
                document.getElementById('newPasswordError').classList.remove('d-none');
                return;
            }

            // Validate confirm password
            if (newPassword !== confirmPassword) {
                document.getElementById('confirmPasswordError').textContent = 'Passwords do not match';
                document.getElementById('confirmPasswordError').classList.remove('d-none');
                return;
            }

            // Update password
            users[userIndex].password = newPassword;
            localStorage.setItem('users', JSON.stringify(users));

            // Clear form
            document.getElementById('passwordForm').reset();
            document.getElementById('passwordStrength').style.width = '0%';
            document.getElementById('passwordStrengthText').textContent = 'Password strength: Enter a password';

            showToast('Password updated successfully!', 'success');
        });

        // Password strength indicator
        document.getElementById('newPassword').addEventListener('input', (e) => {
            const password = e.target.value;
            let strength = 0;
            let text = '';
            let color = '';

            if (password.length >= 6) strength += 25;
            if (password.length >= 10) strength += 25;
            if (/[A-Z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 15;
            if (/[^A-Za-z0-9]/.test(password)) strength += 10;

            if (strength === 0) {
                text = 'Enter a password';
                color = 'var(--gray-500)';
            } else if (strength < 40) {
                text = 'Weak';
                color = 'var(--danger)';
            } else if (strength < 70) {
                text = 'Medium';
                color = 'var(--warning)';
            } else {
                text = 'Strong';
                color = 'var(--success)';
            }

            document.getElementById('passwordStrength').style.width = Math.min(strength, 100) + '%';
            document.getElementById('passwordStrength').style.background = color;
            document.getElementById('passwordStrengthText').textContent = 'Password strength: ' + text;
            document.getElementById('passwordStrengthText').style.color = color;
        });

        // Password visibility toggles
        document.querySelectorAll('.toggle-password').forEach(toggle => {
            toggle.addEventListener('click', () => {
                const targetId = toggle.dataset.target;
                const input = document.getElementById(targetId);
                const icon = toggle.querySelector('i');

                if (input.type === 'password') {
                    input.type = 'text';
                    icon.className = 'fas fa-eye-slash';
                } else {
                    input.type = 'password';
                    icon.className = 'fas fa-eye';
                }
            });
        });

        // Delete account
        const confirmModal = document.getElementById('confirmModal');

        document.getElementById('deleteAccountBtn').addEventListener('click', () => {
            confirmModal.classList.add('active');
        });

        document.getElementById('closeModal').addEventListener('click', () => {
            confirmModal.classList.remove('active');
        });

        document.getElementById('modalCancel').addEventListener('click', () => {
            confirmModal.classList.remove('active');
        });

        document.getElementById('modalConfirm').addEventListener('click', () => {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            let users = JSON.parse(localStorage.getItem('users') || '[]');

            // Remove user from users array
            users = users.filter(u => u.email !== currentUser.email);
            localStorage.setItem('users', JSON.stringify(users));

            // Clear current user session
            localStorage.removeItem('currentUser');

            confirmModal.classList.remove('active');
            showToast('Account deleted successfully', 'success');

            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1500);
        });

        // Toast notification
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
      `;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('currentUser');
            showToast('Logged out successfully!', 'success');
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1000);
        });
    </script>
</body>

</html>